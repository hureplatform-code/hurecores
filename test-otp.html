<!DOCTYPE html>
<html>
<head>
  <title>HURE Core - OTP Test</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
    button { padding: 12px 24px; background: #2563eb; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    button:hover { background: #1d4ed8; }
    input { padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; width: 100%; margin: 10px 0; }
    .result { margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px; }
    .success { background: #d1fae5; color: #065f46; }
    .error { background: #fee2e2; color: #991b1b; }
  </style>
</head>
<body>
  <h1>üß™ HURE Core OTP Test</h1>
  
  <div>
    <h3>Step 1: Send OTP</h3>
    <input type="email" id="email" placeholder="Enter your email">
    <input type="text" id="firstName" placeholder="Your first name">
    <button onclick="sendOTP()">Send OTP</button>
  </div>

  <div style="margin-top: 30px;">
    <h3>Step 2: Verify OTP</h3>
    <input type="text" id="otp" placeholder="Enter 6-digit code" maxlength="6">
    <button onclick="verifyOTP()">Verify OTP</button>
  </div>

  <div id="result" class="result" style="display: none;"></div>

  <script>
    const SUPABASE_URL = 'https://hjridosuleevyjjeirbv.supabase.co';
    const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhqcmlkb3N1bGVldnlqamVpcmJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NDkzOTIsImV4cCI6MjA4MzQyNTM5Mn0._O2irIgL7ZsEpXHQ2l3_ke0ue17eGBSoBUg9yiuKij8';

    async function sendOTP() {
      const email = document.getElementById('email').value;
      const firstName = document.getElementById('firstName').value;
      const resultDiv = document.getElementById('result');

      if (!email) {
        showResult('Please enter an email', 'error');
        return;
      }

      try {
        const response = await fetch(`${SUPABASE_URL}/functions/v1/send-email-otp`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${ANON_KEY}`
          },
          body: JSON.stringify({ email, firstName })
        });

        const data = await response.json();
        
        if (response.ok) {
          showResult(`‚úÖ OTP sent to ${email}! Check your inbox.`, 'success');
        } else {
          showResult(`‚ùå Error: ${data.error}`, 'error');
        }
      } catch (error) {
        showResult(`‚ùå Network error: ${error.message}`, 'error');
      }
    }

    async function verifyOTP() {
      const email = document.getElementById('email').value;
      const otp = document.getElementById('otp').value;

      if (!email || !otp) {
        showResult('Please enter both email and OTP', 'error');
        return;
      }

      try {
        const response = await fetch(`${SUPABASE_URL}/functions/v1/verify-email-otp`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${ANON_KEY}`
          },
          body: JSON.stringify({ email, otp })
        });

        const data = await response.json();
        
        if (response.ok && data.verified) {
          showResult(`‚úÖ Email verified successfully!`, 'success');
        } else {
          showResult(`‚ùå Error: ${data.error}`, 'error');
        }
      } catch (error) {
        showResult(`‚ùå Network error: ${error.message}`, 'error');
      }
    }

    function showResult(message, type) {
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = message;
      resultDiv.className = `result ${type}`;
      resultDiv.style.display = 'block';
    }
  </script>
</body>
</html>
