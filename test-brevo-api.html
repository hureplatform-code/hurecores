<!DOCTYPE html>
<html>
<head>
  <title>Test Brevo Email API</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 700px; margin: 50px auto; padding: 20px; }
    button { padding: 12px 24px; background: #2563eb; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
    button:hover { background: #1d4ed8; }
    input { padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; width: 100%; margin: 10px 0; box-sizing: border-box; }
    .result { margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px; white-space: pre-wrap; font-family: monospace; font-size: 12px; }
    .success { background: #d1fae5; color: #065f46; }
    .error { background: #fee2e2; color: #991b1b; }
    label { font-weight: 600; display: block; margin-top: 15px; }
  </style>
</head>
<body>
  <h1>üß™ Brevo Email API Tester</h1>
  <p>Test if your Brevo API is configured correctly</p>
  
  <div>
    <label>Brevo API Key:</label>
    <input type="text" id="apiKey" value="your-brevo-api-key-here">
    
    <label>From Email:</label>
    <input type="email" id="fromEmail" value="9700d9001@smtp-brevo.com">
    
    <label>From Name:</label>
    <input type="text" id="fromName" value="HURE Core">
    
    <label>To Email (your email):</label>
    <input type="email" id="toEmail" placeholder="clientfiver6@gmail.com">
    
    <button onclick="testBrevoAPI()">Send Test Email</button>
  </div>

  <div id="result" class="result" style="display: none;"></div>

  <div style="margin-top: 30px; padding: 15px; background: #fef3c7; border-radius: 8px;">
    <h3 style="margin-top: 0;">‚ö†Ô∏è Common Issues:</h3>
    <ol>
      <li><strong>Sender email not verified</strong> - Go to Brevo ‚Üí Senders & IP ‚Üí Add sender</li>
      <li><strong>API key invalid</strong> - Check Brevo ‚Üí SMTP & API ‚Üí API Keys</li>
      <li><strong>Daily limit reached</strong> - Free plan: 300 emails/day</li>
    </ol>
  </div>

  <script>
    async function testBrevoAPI() {
      const apiKey = document.getElementById('apiKey').value;
      const fromEmail = document.getElementById('fromEmail').value;
      const fromName = document.getElementById('fromName').value;
      const toEmail = document.getElementById('toEmail').value;
      const resultDiv = document.getElementById('result');

      if (!apiKey || !fromEmail || !toEmail) {
        showResult('Please fill all fields', 'error');
        return;
      }

      try {
        showResult('Sending test email...', '');
        
        const response = await fetch('https://api.brevo.com/v3/smtp/email', {
          method: 'POST',
          headers: {
            'accept': 'application/json',
            'api-key': apiKey,
            'content-type': 'application/json',
          },
          body: JSON.stringify({
            sender: {
              name: fromName,
              email: fromEmail
            },
            to: [{ email: toEmail, name: 'Test User' }],
            subject: 'Test Email from HURE Core',
            htmlContent: `
              <div style="font-family: Arial, sans-serif; padding: 20px;">
                <h2 style="color: #2563eb;">‚úÖ Brevo API Test Successful!</h2>
                <p>If you received this email, your Brevo configuration is working correctly.</p>
                <p><strong>From:</strong> ${fromEmail}</p>
                <p><strong>API Key:</strong> ${apiKey.substring(0, 20)}...</p>
                <hr>
                <p style="color: #6b7280; font-size: 12px;">This is a test email from HURE Core signup system.</p>
              </div>
            `
          })
        });

        const data = await response.json();
        
        if (response.ok) {
          showResult(`‚úÖ SUCCESS!\n\nEmail sent successfully!\nMessage ID: ${data.messageId}\n\nCheck your inbox at ${toEmail}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`, 'success');
        } else {
          showResult(`‚ùå FAILED!\n\nStatus: ${response.status}\n\nError Response:\n${JSON.stringify(data, null, 2)}\n\nüîç Possible fixes:\n1. Verify sender email in Brevo dashboard\n2. Check API key is valid\n3. Ensure you're not over daily limit`, 'error');
        }
      } catch (error) {
        showResult(`‚ùå NETWORK ERROR!\n\n${error.message}\n\nCheck your internet connection`, 'error');
      }
    }

    function showResult(message, type) {
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = message;
      resultDiv.className = `result ${type}`;
      resultDiv.style.display = 'block';
    }
  </script>

  <div style="margin-top: 30px; padding: 15px; background: #eff6ff; border-radius: 8px;">
    <h3 style="margin-top: 0;">üìù Setup Checklist:</h3>
    <ol>
      <li><strong>Verify Sender Email in Brevo</strong>
        <ul>
          <li>Go to: <a href="https://app.brevo.com/senders/list" target="_blank">Brevo Senders</a></li>
          <li>Add and verify your sender email</li>
          <li>Or use default: <code>9700d9001@smtp-brevo.com</code></li>
        </ul>
      </li>
      <li><strong>Confirm API Key</strong>
        <ul>
          <li>Go to: <a href="https://app.brevo.com/settings/keys/api" target="_blank">Brevo API Keys</a></li>
          <li>Copy your API key</li>
          <li>Update in Supabase Edge Function secrets</li>
        </ul>
      </li>
      <li><strong>Set Secret in Supabase</strong>
        <ul>
          <li>Go to: <a href="https://supabase.com/dashboard/project/hjridosuleevyjjeirbv/settings/functions" target="_blank">Supabase Edge Functions Settings</a></li>
          <li>Add secret: <code>BREVO_API_KEY</code></li>
          <li>Value: Your Brevo API key</li>
        </ul>
      </li>
    </ol>
  </div>
</body>
</html>
